<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Proyecto 10 - Gestión de Memoria Física: Entorno de ejecución en IA-32</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Proyecto 10 - Gestión de Memoria Física
   &#160;<span id="projectnumber">0.9</span>
   </div>
   <div id="projectbrief">Aprendiendo Sistemas Operativos</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Buscar');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Página&#160;principal</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Páginas&#160;relacionadas</span></a></li>
      <li><a href="../../modules.html"><span>Módulos</span></a></li>
      <li><a href="../../annotated.html"><span>Estructuras&#160;de&#160;Datos</span></a></li>
      <li><a href="../../files.html"><span>Archivos</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Buscar" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Todo</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Estructuras de Datos</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Archivos</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funciones</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>&apos;typedefs&apos;</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>&apos;defines&apos;</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Grupos</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Páginas</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Entorno de ejecución en IA-32 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Autor</dt><dd>Erwin Meza Vega <a href="#" onclick="location.href='mai'+'lto:'+'eme'+'za'+'v@g'+'ma'+'il.'+'co'+'m'; return false;">emeza<span style="display: none;">.nosp@m.</span>v@gm<span style="display: none;">.nosp@m.</span>ail.c<span style="display: none;">.nosp@m.</span>om</a></dd></dl>
<p><a class="el" href="../../index.html#project_start">Información del Proyecto</a> : <a class="el" href="../../d8/d50/ia32_intro.html">Programación de procesadores de arquitectura IA-32</a> : Entorno de Ejecución</p>
<p>Cualquier programa o tarea a ser ejecutado en un procesador de arquitectura IA-32 cuenta con un entorno de ejecución compuesto por un espacio de direcciones de memoria y un conjunto de registros. A continuación se describen estos componentes.</p>
<h1><a class="anchor" id="ia32_linear_memory"></a>
Espacio Lineal de Direcciones</h1>
<p>En la arquitectura IA-32 la memoria puede ser vista como una secuencia lineal (o un arreglo) de bytes, uno tras del otro. A cada byte le corresponde una dirección única (Ver figura).</p>
<pre class="fragment">                 Espacio Lineal de Direcciones
                +------------------------------+
                |                              |
                |                              |
                |                              |
                |                              |
                |                              |
                |                              |
                |                              |
                |                              |
                +------------------------------+
                | Valor (byte)                 |&lt;-- Siguiente dirección lineal
                +------------------------------+
                | Valor (byte)                 |
                +------------------------------+&lt;--+
                |                              |   | Dirección lineal
                |                              |   | (desplazamiento desde el
                |                              |   | inicio del espacio lineal)
                |                              |   |
                |                              |   |
                +------------------------------+   |</pre><p>El código dentro de una tarea o un programa puede referenciar un espacio lineal de direcciones tan grande como lo permitan los registros del procesador. Por ejemplo, en modo real sólo es posible acceder a los 64 KB dentro de un segmento definido (2^16 = 64 KB), y en modo protegido de 32 bits se puede acceder a un espacio lineal de hasta 4 GB (2^32 = 4 GB).</p>
<p>Este espacio lineal puede estar mapeado directamente a la memoria física. Si el procesador cuenta con las extensiones requeridas, es posible acceder a un espacio físico de hasta 64 Gigabytes.</p>
<p>Se debe recordar que la arquitectura IA-32 siempre hace uso de un modelo de memoria segmentado, sin importar su modo de operación (<a class="el" href="../../d4/de9/ia32_memory_organization.html">Organización de Memoria en Procesadores IA-32</a>). Los sistemas operativos actuales optan por usar un modelo plano (Flat) en modo protegido, por lo cual pueden tener acceso a todo el espacio lineal de direcciones.</p>
<h1><a class="anchor" id="ia32_io_memory"></a>
Espacio de Direcciones de Entrada / Salida</h1>
<p>Los procesadores IA-32 incluyen otro espacio de direcciones, diferente al espacio lineal de direcciones , llamado espacio de direcciones de Entrada / Salida. A este espacio de 65536 (64K) direcciones se mapean los registros de los controladores de dispositivos de entrada / salida como el teclado, los discos o el mouse (Ver figura).</p>
<pre class="fragment">               Espacio de direcciones de E/S
               
                     65535           
  +----------------+
  |                |
  |                |               Controlador de           Dispositivo
  |                |               Dispositivo             (disco, teclado, etc)
  +----------------+               +---------+              +---------------+
  |   byte         |&lt;------------- | estado  |&lt;-------------|               |
  +----------------+               +---------+              |               |
  |   byte         |&lt;------------- | control |&lt;-------------|               |
  +----------------+               +---------+              +---------------+
  |                |
  |                |
  +----------------+</pre><p>El acceso al espacio de direcciones de E/S se realiza a través de un par de instrucciones específicas del procesador (in y out). Al leer o escribir un byte en una dirección de E/S, el byte se transfiere al puerto correspondiente del dispositivo.</p>
<p>Se debe consultar la documentación de cada dispositivo de E/S para determinar cuales son las direcciones de E/S a través de las cuales se puede acceder a los registros de su controlador.</p>
<p>Por ejemplo, el controlador de teclado (8042) tiene asignadas las siguientes direcciones de entrada / salida:</p>
<pre class="fragment">Dirección de E/S         Operación             Descripción
0x60                     Lectura               Buffer de entrada
0x60                     Escritura             Puerto de comandos
0x64                     Lectura               Registro de Estado del teclado
0x64                     Escritura             Puerto de comandos</pre><p>Este controlador deberá ser programado para habilitar la línea de direcciones A20, que en los procesadores actuales se encuentra deshabilitada al inicio para permitir la compatibilidad con programas desarrollados para procesadores anteriores.</p>
<h1><a class="anchor" id="ia32_register_set"></a>
Conjunto de Registros IA-32</h1>
<p>El procesador cuenta con una serie de registros en los cuales puede almacenar datos. Estos registros pueden ser clasificados en:</p>
<ul>
<li>Registros de propósito general: Utilizados para almacenar valores, realizar operaciones aritméticas o lógicas o para referenciar el espacio de direcciones lineal o de E/S. En procesadores IA-32 bits existen ocho (8) registros de propósito general, cada uno de los cuales tiene un tamaño de 32 bits. Estos registros son: EAX, EBX, ECX, EDX, ESI, EDI, ESP y EBP. A pesar que se denominan registros de propósito general, y pueden ser utilizados como tal, estos registros tienen usos especiales para algunas instrucciones del procesador. Ppor ejemplo la instrucción DIV (dividir) hace uso especial de los registros EAX y EDX, dependiendo del tamaño del operando.</li>
<li>Registros de segmento: Estos registros permiten almacenar apuntadores al espacio de direcciones lineal. Los procesadores IA-32 poseen seis (6) registros de segmento. Estos son: CS (código), DS (datos), ES, FS, GS (datos), y SS (pila). Su uso depende del modo de operación. En modo real, los registros de segmento almacenan un apuntador a la dirección lineal del inicio del segmento dividida en 16. En modo protegido se denominan 'selectores', y contienen un apuntador a una estructura de datos en la cual se describe un segmento de memoria (ver <a class="el" href="../../d8/dfe/gdt_page.html">Tabla Global de Descriptores - GDT</a>).</li>
<li>Registro EFLAGS: Este registro de 32 bits contiene una serie de banderas (flags) que tienen diversos usos. Algunas reflejan el estado del procesador y otras controlan su ejecución. Existen instrucciones específicas para modificar el valor de EFLAGS. Otras instrucciones modifican el valor de EFLAGS de forma implícita. Por ejemplo, si al realizar una operación aritmética o lógica se obtiene como resultado cero, el bit ZF (Zero Flag) del registro EFLAGS se establece en 1, para indicar esta condición. Esta bandera puede ser chequeada para realizar algún tipo de opración o salto dentro del código.</li>
<li>Registro EIP: Este registro almacena el apuntador a la dirección lineal de la siguiente instrucción que el procesador debe ejecutar. Esta dirección es relativa al segmento al cual se referencia con el registro de segmento CS.</li>
<li>Registros de control: El procesador posee cinco (5) registros de control CR0 a CR5. Estos registros junto con EFLAGS controlan la ejecución del procesador.</li>
<li>Registros para el control de la memoria: Estos registros apuntan a las estructura de datos requeridas para el funcionamiento del procesador en modo protegido. Ellos son: GDTR, IDTR, TR y LDTR.</li>
<li>Registros de depuración: Estos registros contienen información que puede ser usada para depurar el código que está ejecutando el procesador. Los procesadores IA-32 cuentan con ocho (8) registros de depuración, DR0 a DR7.</li>
<li>Registros específicos: Cada variante de procesador IA-32 incluye otros registros, tales como los registros MMX, los registros de la unidad de punto flotante (FPU) entre otros.</li>
</ul>
<p>Algunos registros de propósito general pueden ser sub-divididos en registros más pequeños a los cuales se puede tener acceso. Esto permite la compatibilidad con programas diseñados para procesadores anteriores.</p>
<p>A continuación se presentan las posibles sub-divisiones de los registros de propósito general, considerando procesadores de hasta 64 bits:</p>
<pre class="fragment">64 bits   32 bits   16 bits   8 bits   8 bits
RAX         EAX        AX       AH        AL
RBX         EBX        BX       BH        BL
RCX         ECX        CX       CH        CL
RDX         EDX        DX       DH        DL
RSI         ESI        SI       No accesible
RDI         EDI        DI       No accesible
RSP         ESP        SP       No accesible
RBP         EBP        BP       No accesible
</pre><p>A nivel de programación, es posible acceder a cada uno de estos sub-registros de acuerdo con el modo de operación. Por ejemplo, para modo de direcciones real, es posible usar los registros de 8 bits y los registros de 16 bits. En modo protegido se puede usar los registros de 8, 16 y 32 bits. Si el procesador cuenta con registros de 64 bits y se encuentra en el modo de 64 bits, es posible acceder a los registros de 8, 16, 32 y 64 bits.</p>
<p>La siguiente figura muestra como se encuentran dispuestos los bits de los registros de propósito general. Los registros EBX, ECX y EDX se encuentran dispuestos de la misma forma que EAX. Los registros EDI, ESP Y EBP se disponen de la misma forma que ESI.</p>
<pre class="fragment">             Subdivisión de los registros EAX, EBX, ECX y EDX
  63                                   31                15         7       0
  +------------------------------------+-----------------+---------+--------+
  |                                    |                 |         |        |
  |                                    |                 |         |        |
  +------------------------------------+-----------------+---------+--------+
                                                         |-- AH ---|-- Al --|     
                                                         |------- AX -------|
                                       |---------------- EAX ---------------| 
  |-------------------------------   RAX  ----------------------------------|                     


             Subdivisión de los registros ESI, EDI, ESP y EBP
  63                                   31                15                 0
  +------------------------------------+-----------------+------------------+
  |                                    |                 |                  |
  |                                    |                 |                  |
  +------------------------------------+-----------------+------------------+
                                                         |------- SI -------|
                                       |---------------- ESI ---------------| 
  |-------------------------------   RSI  ----------------------------------|                     </pre><dl class="section user"><dt>Formato de almacenamiento de datos</dt><dd></dd></dl>
<p>El formato de almacenamiento de la arquitectura IA-32 es Little-Endian, lo cual significa que los bits menos significativos de un número se almacenan en las posiciones menores de la memoria y de los registros, y los bits más significativos se almacenan en posiciones superiores. La siguiente figura muestra cómo se almacena el número 0x7C00 en un registro y en la memoria.</p>
<p>El número 0x7C00 almacenado en un registro se ve así: </p>
<pre class="fragment">  Número en formato hexadecimal: 0x7C00
                           
                Número almacenado en un registro
           Bit más                                      Bit menos
           significativo                              significativo
              15                                              0
  +-----------------------------------------------------------+
  | 0| 0| 0| 0| 0| 1| 1| 1| 1| 1| 0| 0| 0| 0| 0| 0| 0| 0| 0| 0| 
  +-----------------------------------------------------------+
                                                  |--- 0 -----|
                                      |--- 0 -----|
                          |--- C -----|
               |--- 7 ----|</pre><p>El mismo número almacenado en memoria se ve así:</p>
<pre class="fragment">               Número almacenado en memoria
               Cada dirección de memoria almacena un byte (8 bits)
               
               +-----------------------+
               |  |  |  |  |  |  |  |  |                   ^
               +-----------------------+                   |  Dirección de 
               |  |  |  |  |  |  |  |  |                   |  incremento
               +-----------------------+                   |  en la memoria
               |  |  |  |  |  |  |  |  |                   |
               +-----------------------+
               |  |  |  |  |  |  |  |  |
               +-----------------------+
       = 0x7C  | 0| 1| 1| 1| 1| 1| 0| 0|   &lt;-- Dirección mayor de memoria
               +-----------------------+
       = 0x00  | 0| 0| 0| 0| 0| 0| 0| 0|   &lt;-- Dirección menor de memoria
               +-----------------------+           </pre><h1><a class="anchor" id="ia32_main_registers"></a>
Registros principales de IA-32</h1>
<p>Si bien todos los registros de la arquitectura IA-32 son importantes, existen algunos que determinan el modo de ejecución el estado del procesador. A continuación se presenta el formato de estos registros.</p>
<dl class="section user"><dt>Registro EFLAGS</dt><dd></dd></dl>
<p>Este registro almacena información del estado del procesador y configura su ejecución. Tiene el formato que se presenta en la siguiente figura.</p>
<pre class="fragment">Registro EFLAGS (32 bits)


      31               23              15              7             0
      +---------------------------------------------------------------+
      | | | | | | | | | | | |V|V| | | | | |   | | | | | | | | | | | | |
      |0|0|0|0|0|0|0|0|0|0|I|I|I|A|V|R|0|N|IO |O|D|I|T|S|Z|0|A|0|P|1|C|
      | | | | | | | | | | |D|P|F|C|M|F| |T|PL |F|F|F|F|F|F| |F| |F| |F|
      +---------------------------------------------------------------+
                           | | | | | |   |  |  | | | | | |   |   |   |
  ID Flag -----------------+ | | | | |   |  |  | | | | | |   |   |   |
  Virtual Interrupt Pending -+ | | | |   |  |  | | | | | |   |   |   |
  Virtual Interrupt Flag  -----+ | | |   |  |  | | | | | |   |   |   |
  Alignment Check ---------------+ | |   |  |  | | | | | |   |   |   |
  Virtual 8086 Mode ---------------+ |   |  |  | | | | | |   |   |   |
  Resume Flag -----------------------+   |  |  | | | | | |   |   |   |
  Nested Task ---------------------------+  |  | | | | | |   |   |   |
  I/O Privilege Level ----------------------+  | | | | | |   |   |   |
  Overflow Flag -------------------------------+ | | | | |   |   |   |
  Direction Flag --------------------------------+ | | | |   |   |   |
  Interrupt Flag ----------------------------------+ | | |   |   |   |
  Trap Flag -----------------------------------------+ | |   |   |   |
  Sign Flag -------------------------------------------+ |   |   |   |
  Zero Flag ---------------------------------------------+   |   |   |
  Auxiliary Carry Flag --------------------------------------+   |   |
  Parity Flag ---------------------------------------------------+   |
  Carry Flag --------------------------------------------------------+</pre><p>Los bits del registro EFLAGS se pueden clasificar en:</p>
<ul>
<li>Bits de estado: Reflejan el estado actual del procesador. Son bits de estado: OF, SF, ZF, AF y PF.</li>
<li>Bits de control: Controlan de alguna forma la ejecución del procesador. Dentro de EFLAGS se encuentra el bit DF, que permite controlar la dirección de avance en las operaciones sobre cadenas de caracteres.</li>
<li>Bits del sistema: Los bits ID, VIP, VIF, AC, VM, RF, NT, IOPL, IF y TF son usados por el procesador para determinar condiciones en su ejecución, o para habilitar / deshabilitar determinadas características. Por ejemplo, estableciendo el bit IF en 1 se habilitan las interrupciones, mientras un valor de 0 en este bit deshabilita las interrupciones.</li>
<li>Bits reservados: Estos bits se reservan por la arquitectura IA-32 para futura expansión. Deben permanecer con los valores que se muestran en la figura (cero o uno). No se deben usar, ya que es posible que en versiones posteriores de los procesadores IA-32 tengan un significado específico.</li>
</ul>
<dl class="section user"><dt>Registro CR0</dt><dd></dd></dl>
<p>A continuación se ilustra el Control Register 0 (CR0). Este registro controla aspectos vitales de la ejecución, como el modo protegido y la paginación.</p>
<pre class="fragment">Registro CR0 (32 bits)


      31               23        18 16 15              7             0
      +---------------------------------------------------------------+
      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | |
      |P|C|N| | | | | | | | | | |A| |W| | | | | | | | | | |N|E|T|E|M|P|
      |G|D|W| | | | | | | | | | |M| |P| | | | | | | | | | |E|T|S|M|P|E|
      +---------------------------------------------------------------+
       | | |                     |  |                      | | | | | |
       +-|-|-- Paging            |  |                      | | | | | |
         | |                     |  |                      | | | | | |
         +-|-- Cache Disable     |  |                      | | | | | |
           |                     |  |                      | | | | | |
           +-- Non-write through |  |                      | | | | | |
                                 |  |                      | | | | | |
  Alignment Mask ----------------+  |                      | | | | | |
  Write Protect --------------------+                      | | | | | |
  Numeric Error -------------------------------------------+ | | | | |
  Extension Type --------------------------------------------+ | | | |
  Task Switched -----------------------------------------------+ | | |
  Emulation -----------------------------------------------------+ | |
  Monitor Coprocessor ---------------------------------------------+ |
  Protection Enable -------------------------------------------------+</pre><p>Los bits más importantes de CR0 desde el punto de vista de programación son el bit 0 (Protection Enable – PE), y el bit 31 (Paging – PG). Estos permiten habilitar el modo protegido y la paginación, respectivamente.</p>
<p>No obstante antes de pasar a modo protegido y de habilitar la paginación se deben configurar unas estructuras de datos que controlan la ejecución del procesador.</p>
<p>Para habilitar el modo protegido se deberá tener configurada de antemano una <a class="el" href="../../d8/dfe/gdt_page.html">Tabla Global de Descriptores - GDT</a>. Esta tabla deberá ser configurada por el cargador de arranque o por el código inicial del kernel. </p>
<dl class="section see"><dt>Ver también</dt><dd><a class="el" href="../../d8/d4b/ia32_assembly_basics.html">Ensamblador para procesadores IA-32</a> </dd>
<dd>
<a class="el" href="../../d3/d4c/ia32_operation_modes.html">Modos de Operación de procesadores IA-32</a> </dd>
<dd>
<a class="el" href="../../d1/d75/bios_and_booting.html">BIOS y Arranque del Computador</a> </dd>
<dd>
<a class="el" href="../../d0/dec/protected_mode_setup.html">Paso a Modo Protegido en Procesadores IA-32</a></dd>
<dd>
<a href="http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html">http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html</a> (Enlace externo) </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generado por &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
